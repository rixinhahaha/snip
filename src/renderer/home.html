<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Snip</title>
  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="home.css">
</head>
<body>
  <div id="sidebar">
    <h1>
      <!-- Dark theme logo — no background, blends with sidebar -->
      <svg class="logo-dark" width="32" height="32" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="slBlade" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#C4B5FD"/>
            <stop offset="50%" stop-color="#8B5CF6"/>
            <stop offset="100%" stop-color="#7C3AED"/>
          </linearGradient>
          <linearGradient id="slHandle" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#A78BFA"/>
            <stop offset="100%" stop-color="#8B5CF6"/>
          </linearGradient>
        </defs>
        <g transform="translate(50,52) rotate(-15) scale(0.16)">
          <g transform="rotate(20)"><path d="M-28,0 C-33,-100 -11,-280 0,-280 C11,-280 33,-100 28,0Z" fill="url(#slBlade)" opacity="0.95"/></g>
          <g transform="rotate(-20)"><path d="M-28,0 C-33,-100 -11,-280 0,-280 C11,-280 33,-100 28,0Z" fill="url(#slBlade)" opacity="0.95"/></g>
          <circle cx="0" cy="0" r="38" fill="url(#slHandle)"/>
          <circle cx="-4" cy="-5" r="14" fill="rgba(255,255,255,0.3)"/>
          <g transform="rotate(20)"><ellipse cx="0" cy="180" rx="90" ry="110" fill="none" stroke="url(#slHandle)" stroke-width="28"/></g>
          <g transform="rotate(-20)"><ellipse cx="0" cy="180" rx="90" ry="110" fill="none" stroke="url(#slHandle)" stroke-width="28"/></g>
        </g>
        <g fill="#C4B5FD" opacity="0.7">
          <path transform="translate(18,18) scale(0.55)" d="M0,-10 C1.5,-3.2 3.2,-1.5 10,0 C3.2,1.5 1.5,3.2 0,10 C-1.5,3.2 -3.2,1.5 -10,0 C-3.2,-1.5 -1.5,-3.2 0,-10Z"/>
          <path transform="translate(82,24) scale(0.40)" d="M0,-10 C1.5,-3.2 3.2,-1.5 10,0 C3.2,1.5 1.5,3.2 0,10 C-1.5,3.2 -3.2,1.5 -10,0 C-3.2,-1.5 -1.5,-3.2 0,-10Z"/>
        </g>
      </svg>
      <!-- Light theme logo — no background, blends with sidebar -->
      <svg class="logo-light" width="32" height="32" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="slBladeL" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#A78BFA"/>
            <stop offset="50%" stop-color="#7C3AED"/>
            <stop offset="100%" stop-color="#6D28D9"/>
          </linearGradient>
          <linearGradient id="slHandleL" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#8B5CF6"/>
            <stop offset="100%" stop-color="#7C3AED"/>
          </linearGradient>
        </defs>
        <g transform="translate(50,52) rotate(-15) scale(0.16)">
          <g transform="rotate(20)"><path d="M-28,0 C-33,-100 -11,-280 0,-280 C11,-280 33,-100 28,0Z" fill="url(#slBladeL)" opacity="0.95"/></g>
          <g transform="rotate(-20)"><path d="M-28,0 C-33,-100 -11,-280 0,-280 C11,-280 33,-100 28,0Z" fill="url(#slBladeL)" opacity="0.95"/></g>
          <circle cx="0" cy="0" r="38" fill="url(#slHandleL)"/>
          <circle cx="-4" cy="-5" r="14" fill="rgba(255,255,255,0.35)"/>
          <g transform="rotate(20)"><ellipse cx="0" cy="180" rx="90" ry="110" fill="none" stroke="url(#slHandleL)" stroke-width="28"/></g>
          <g transform="rotate(-20)"><ellipse cx="0" cy="180" rx="90" ry="110" fill="none" stroke="url(#slHandleL)" stroke-width="28"/></g>
        </g>
        <g fill="#7C3AED" opacity="0.5">
          <path transform="translate(18,18) scale(0.55)" d="M0,-10 C1.5,-3.2 3.2,-1.5 10,0 C3.2,1.5 1.5,3.2 0,10 C-1.5,3.2 -3.2,1.5 -10,0 C-3.2,-1.5 -1.5,-3.2 0,-10Z"/>
          <path transform="translate(82,24) scale(0.40)" d="M0,-10 C1.5,-3.2 3.2,-1.5 10,0 C3.2,1.5 1.5,3.2 0,10 C-1.5,3.2 -3.2,1.5 -10,0 C-3.2,-1.5 -1.5,-3.2 0,-10Z"/>
        </g>
      </svg>
    Snip</h1>
    <button class="nav-item active" data-page="screenshots" title="Saved">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <path d="M21 15l-5-5L5 21"/>
      </svg>
    </button>
    <button class="nav-item" data-page="search" title="Search">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
    </button>
    <button class="nav-item" data-page="settings" title="Settings">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
      </svg>
    </button>
  </div>

  <div id="main">
    <!-- Screenshots page -->
    <div id="page-screenshots" class="page active">
      <div id="screenshots-header">
        <div id="folder-breadcrumb"></div>
        <button class="icon-btn" id="btn-refresh" title="Refresh">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"/>
            <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
          </svg>
        </button>
        <button class="icon-btn" id="btn-open-finder" title="Open in Finder">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </button>
      </div>
      <div id="file-grid"></div>
      <div id="empty-folder" class="hidden">No snips yet. Press Cmd+Shift+2 to capture.</div>
    </div>

    <!-- Search page -->
    <div id="page-search" class="page">
      <div id="search-header">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" id="search-input" placeholder="Search snips...">
        <span id="search-loading" class="search-loading hidden">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="2.5">
            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
          </svg>
        </span>
        <span id="search-result-count"></span>
      </div>
      <div id="search-tags" class="search-tags hidden"></div>
      <div id="search-results-grid"></div>
      <div id="search-empty" class="hidden">
        <p>No snips indexed yet. Save some snips and they'll appear here after organization.</p>
      </div>
      <div id="search-no-results" class="hidden">
        <p>No matching snips found.</p>
      </div>
    </div>

    <!-- Settings page -->
    <div id="page-settings" class="page">
      <div id="settings-content">
        <h2>Settings</h2>

        <div class="settings-section">
          <h3>Appearance</h3>
          <p>Choose your preferred theme.</p>
          <div class="theme-toggle">
            <button id="theme-dark" class="theme-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
              </svg>
              Dark
            </button>
            <button id="theme-light" class="theme-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
              </svg>
              Light
            </button>
            <button id="theme-glass" class="theme-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"/>
              </svg>
              Glass
            </button>
          </div>
        </div>

        <div class="settings-section" id="ai-assistant-section">
          <h3>Local AI Assistant</h3>
          <p>AI-powered snip organization runs locally on your machine using Ollama.</p>

          <div class="ollama-checklist">
            <div class="checklist-item">
              <span id="check-installed" class="check-icon pending">○</span>
              <span class="checklist-label">Ollama installed</span>
            </div>
            <div class="checklist-item">
              <span id="check-running" class="check-icon pending">○</span>
              <span class="checklist-label">Ollama running</span>
            </div>
            <div class="checklist-item">
              <span id="check-model" class="check-icon pending">○</span>
              <span class="checklist-label">Model downloaded</span>
            </div>
          </div>

          <button id="ollama-setup-btn" class="ollama-action-btn" style="margin-top: 12px;">Set up</button>

          <div id="ollama-ready-info" class="hidden" style="margin-top: 12px;">
            <div class="current-model-card">
              <span class="current-model-label">Active Model</span>
              <div class="current-model-header">
                <span id="current-model-name" class="current-model-name">—</span>
                <button class="icon-btn model-info-btn" id="model-info-btn" title="Model info">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4"/>
                    <circle cx="12" cy="8" r="0.5" fill="currentColor" stroke="none"/>
                  </svg>
                </button>
              </div>
              <div id="model-info-tooltip" class="model-info-tooltip hidden">
                <table class="model-info-table">
                  <tr><td class="model-info-label">Model</td><td id="info-model">—</td></tr>
                  <tr><td class="model-info-label">Parameters</td><td id="info-params">—</td></tr>
                  <tr><td class="model-info-label">Size</td><td id="info-size">—</td></tr>
                  <tr><td class="model-info-label">Quantization</td><td id="info-quant">—</td></tr>
                  <tr><td class="model-info-label">Description</td><td id="info-desc">—</td></tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Animation (2GIF)</h3>
          <p>Animate cutouts into GIF/APNG using AI-powered video generation.</p>
          <div class="animation-api-key-row">
            <label class="animation-api-key-label" for="fal-api-key">fal.ai API Key</label>
            <div class="animation-api-key-input-group">
              <input type="password" id="fal-api-key" class="animation-api-key-input"
                     placeholder="Enter your fal.ai API key…" autocomplete="off" spellcheck="false">
              <button class="animation-api-key-toggle" id="fal-api-key-toggle" title="Show/hide key">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
              <button class="animation-api-key-save" id="fal-api-key-save">Save</button>
            </div>
            <div class="animation-api-key-status" id="fal-api-key-status"></div>
            <div class="animation-api-key-help">
              Get your API key from <a href="#" id="fal-api-key-link">fal.ai/dashboard/keys</a>
            </div>
          </div>
          <div class="animation-info-grid">
            <div class="animation-info-item">
              <span class="animation-info-label">Provider</span>
              <span class="animation-info-value">fal.ai (Wan 2.2)</span>
            </div>
            <div class="animation-info-item">
              <span class="animation-info-label">Resolution</span>
              <span class="animation-info-value">480p</span>
            </div>
            <div class="animation-info-item">
              <span class="animation-info-label">Max Duration</span>
              <span class="animation-info-value">4 seconds</span>
            </div>
            <div class="animation-info-item">
              <span class="animation-info-label">Output</span>
              <span class="animation-info-value">GIF + APNG</span>
            </div>
            <div class="animation-info-item">
              <span class="animation-info-label">Save Location</span>
              <span class="animation-info-value">~/Documents/snip/screenshots/animations/</span>
            </div>
            <div class="animation-info-item">
              <span class="animation-info-label">AI Presets</span>
              <span id="animation-presets-status" class="animation-info-value">Checking…</span>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3>Snip Tags</h3>
          <p>Edit descriptions to guide how the AI categorizes your snips.</p>
          <div id="tags-list" class="tags-list"></div>
          <div class="add-tag">
            <input type="text" id="new-tag-name" placeholder="New tag...">
            <input type="text" id="new-tag-description" placeholder="Description...">
            <button class="icon-btn" id="add-tag-btn" title="Add tag">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
            </button>
          </div>
          <div id="tags-status" class="status"></div>
        </div>

        <div class="settings-section">
          <h3>Keyboard Shortcuts</h3>
          <p>All available commands and their keyboard shortcuts.</p>
          <table class="shortcuts-table">
            <thead>
              <tr><th>Action</th><th>Shortcut</th><th>Context</th></tr>
            </thead>
            <tbody>
              <tr><td>Snip It</td><td><kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>2</kbd></td><td>Global</td></tr>
              <tr><td>Search snips</td><td><kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>F</kbd></td><td>Global</td></tr>
              <tr><td>Confirm selection / full screen</td><td><kbd>Enter</kbd></td><td>Selection mode</td></tr>
              <tr><td>Clear selection / cancel</td><td><kbd>Esc</kbd></td><td>Selection mode</td></tr>
              <tr><td>Select tool</td><td><kbd>V</kbd></td><td>Annotation</td></tr>
              <tr><td>Rectangle tool</td><td><kbd>R</kbd></td><td>Annotation</td></tr>
              <tr><td>Text tool</td><td><kbd>T</kbd></td><td>Annotation</td></tr>
              <tr><td>Arrow tool</td><td><kbd>A</kbd></td><td>Annotation</td></tr>
              <tr><td>Blur Brush tool</td><td><kbd>B</kbd></td><td>Annotation</td></tr>
              <tr><td>Segment tool</td><td><kbd>S</kbd></td><td>Annotation</td></tr>
              <tr><td>Undo</td><td><kbd>Cmd</kbd> + <kbd>Z</kbd></td><td>Annotation</td></tr>
              <tr><td>Delete selected</td><td><kbd>Delete</kbd> / <kbd>Backspace</kbd></td><td>Annotation</td></tr>
              <tr><td>Save snip</td><td><kbd>Cmd</kbd> + <kbd>S</kbd></td><td>Annotation</td></tr>
              <tr><td>Copy &amp; close</td><td><kbd>Esc</kbd></td><td>Annotation</td></tr>
              <tr><td>Save GIF</td><td><kbd>Enter</kbd> / <kbd>Cmd</kbd> + <kbd>S</kbd></td><td>GIF Preview</td></tr>
              <tr><td>Redo animation</td><td><kbd>R</kbd></td><td>GIF Preview</td></tr>
              <tr><td>Discard animation</td><td><kbd>Esc</kbd></td><td>GIF Preview</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Context menu -->
  <div id="context-menu" class="context-menu hidden">
    <button id="ctx-open" class="context-menu-item">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
        <polyline points="15 3 21 3 21 9"/>
        <line x1="10" y1="14" x2="21" y2="3"/>
      </svg>
      Reveal in Finder
    </button>
    <button id="ctx-delete" class="context-menu-item danger">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="3 6 5 6 21 6"/>
        <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
      </svg>
      Move to Trash
    </button>
  </div>

  <script src="home.js"></script>
</body>
</html>
